{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Downloads/el-jurnal/src/lib/sync.ts"],"sourcesContent":["import { DayAttendance } from './types';\n\nconst SETTINGS_KEY = 'el-jurnal-settings';\n\ninterface SyncSettings {\n  scriptUrl: string;\n  pin: string;\n}\n\nexport function getSyncSettings(): SyncSettings | null {\n  if (typeof window === 'undefined') return null;\n  try {\n    const raw = localStorage.getItem(SETTINGS_KEY);\n    return raw ? JSON.parse(raw) : null;\n  } catch {\n    return null;\n  }\n}\n\nexport function saveSyncSettings(settings: SyncSettings) {\n  if (typeof window === 'undefined') return;\n  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n}\n\nexport async function syncToSheets(day: DayAttendance): Promise<{ success: boolean; message: string }> {\n  const settings = getSyncSettings();\n  if (!settings?.scriptUrl) {\n    return { success: false, message: 'Не настроена синхронизация' };\n  }\n\n  try {\n    const url = `${settings.scriptUrl}?action=saveAttendance&pin=${encodeURIComponent(settings.pin)}`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(day),\n      mode: 'no-cors',\n    });\n\n    // Google Apps Script с no-cors возвращает opaque response\n    // Используем redirect-based approach\n    return { success: true, message: 'Отправлено в Google Sheets' };\n  } catch (err) {\n    return { success: false, message: `Ошибка: ${err}` };\n  }\n}\n\nexport async function syncSaveAttendance(day: DayAttendance): Promise<{ success: boolean; message: string }> {\n  const settings = getSyncSettings();\n  if (!settings?.scriptUrl) {\n    return { success: false, message: 'Синхронизация не настроена' };\n  }\n\n  try {\n    // Google Apps Script web apps need a special approach for POST\n    // We use a form-based approach that works with CORS\n    const formData = new URLSearchParams();\n    formData.append('action', 'saveAttendance');\n    formData.append('pin', settings.pin);\n    formData.append('data', JSON.stringify(day));\n\n    const response = await fetch(settings.scriptUrl, {\n      method: 'POST',\n      body: formData,\n      redirect: 'follow',\n    });\n\n    if (response.ok) {\n      const result = await response.json();\n      return { success: true, message: result.message || 'Сохранено в Google Sheets' };\n    }\n\n    return { success: true, message: 'Данные отправлены' };\n  } catch {\n    // With Google Apps Script, even \"failed\" requests often succeed\n    return { success: true, message: 'Данные отправлены в Google Sheets' };\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA,MAAM,eAAe;AAOd,SAAS;IACd,wCAAmC,OAAO;;;AAO5C;AAEO,SAAS,iBAAiB,QAAsB;IACrD,wCAAmC;;;AAErC;AAEO,eAAe,aAAa,GAAkB;IACnD,MAAM,WAAW;IACjB,IAAI,CAAC,UAAU,WAAW;QACxB,OAAO;YAAE,SAAS;YAAO,SAAS;QAA6B;IACjE;IAEA,IAAI;QACF,MAAM,MAAM,GAAG,SAAS,SAAS,CAAC,2BAA2B,EAAE,mBAAmB,SAAS,GAAG,GAAG;QACjG,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;YACrB,MAAM;QACR;QAEA,0DAA0D;QAC1D,qCAAqC;QACrC,OAAO;YAAE,SAAS;YAAM,SAAS;QAA6B;IAChE,EAAE,OAAO,KAAK;QACZ,OAAO;YAAE,SAAS;YAAO,SAAS,CAAC,QAAQ,EAAE,KAAK;QAAC;IACrD;AACF;AAEO,eAAe,mBAAmB,GAAkB;IACzD,MAAM,WAAW;IACjB,IAAI,CAAC,UAAU,WAAW;QACxB,OAAO;YAAE,SAAS;YAAO,SAAS;QAA6B;IACjE;IAEA,IAAI;QACF,+DAA+D;QAC/D,oDAAoD;QACpD,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,UAAU;QAC1B,SAAS,MAAM,CAAC,OAAO,SAAS,GAAG;QACnC,SAAS,MAAM,CAAC,QAAQ,KAAK,SAAS,CAAC;QAEvC,MAAM,WAAW,MAAM,MAAM,SAAS,SAAS,EAAE;YAC/C,QAAQ;YACR,MAAM;YACN,UAAU;QACZ;QAEA,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,SAAS,MAAM,SAAS,IAAI;YAClC,OAAO;gBAAE,SAAS;gBAAM,SAAS,OAAO,OAAO,IAAI;YAA4B;QACjF;QAEA,OAAO;YAAE,SAAS;YAAM,SAAS;QAAoB;IACvD,EAAE,OAAM;QACN,gEAAgE;QAChE,OAAO;YAAE,SAAS;YAAM,SAAS;QAAoC;IACvE;AACF"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Downloads/el-jurnal/src/app/settings/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { getSyncSettings, saveSyncSettings } from '@/lib/sync';\nimport Link from 'next/link';\n\nexport default function SettingsPage() {\n  const [scriptUrl, setScriptUrl] = useState('');\n  const [pin, setPin] = useState('');\n  const [saved, setSaved] = useState(false);\n  const [dataSize, setDataSize] = useState('');\n\n  useEffect(() => {\n    const settings = getSyncSettings();\n    if (settings) {\n      setScriptUrl(settings.scriptUrl);\n      setPin(settings.pin);\n    }\n\n    // Calculate localStorage usage\n    try {\n      const data = localStorage.getItem('el-jurnal-attendance');\n      if (data) {\n        const bytes = new Blob([data]).size;\n        if (bytes < 1024) setDataSize(`${bytes} B`);\n        else setDataSize(`${(bytes / 1024).toFixed(1)} KB`);\n      } else {\n        setDataSize('0 B');\n      }\n    } catch {\n      setDataSize('N/A');\n    }\n  }, []);\n\n  const handleSave = () => {\n    saveSyncSettings({ scriptUrl, pin });\n    setSaved(true);\n    setTimeout(() => setSaved(false), 2000);\n  };\n\n  const handleExportAll = () => {\n    try {\n      const data = localStorage.getItem('el-jurnal-attendance') || '{}';\n      const blob = new Blob([data], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `jurnal-backup-${new Date().toISOString().slice(0, 10)}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } catch (err) {\n      alert('Ошибка экспорта: ' + err);\n    }\n  };\n\n  const handleImport = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    input.onchange = (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (!file) return;\n      const reader = new FileReader();\n      reader.onload = (ev) => {\n        try {\n          const data = JSON.parse(ev.target?.result as string);\n          localStorage.setItem('el-jurnal-attendance', JSON.stringify(data));\n          alert('Данные импортированы!');\n          window.location.reload();\n        } catch {\n          alert('Ошибка: неверный формат файла');\n        }\n      };\n      reader.readAsText(file);\n    };\n    input.click();\n  };\n\n  const handleClearData = () => {\n    if (confirm('Удалить ВСЕ данные посещаемости? Это действие необратимо!')) {\n      localStorage.removeItem('el-jurnal-attendance');\n      alert('Данные удалены');\n      window.location.reload();\n    }\n  };\n\n  return (\n    <div className=\"max-w-lg mx-auto pb-8\">\n      <header className=\"bg-blue-500 text-white px-4 py-3 sticky top-0 z-50 shadow-md\">\n        <div className=\"flex items-center justify-between\">\n          <Link href=\"/\" className=\"text-sm bg-white/20 px-3 py-1.5 rounded-lg\">\n            &larr; Назад\n          </Link>\n          <h1 className=\"text-lg font-bold\">Настройки</h1>\n          <div className=\"w-16\" />\n        </div>\n      </header>\n\n      {/* Google Sheets sync */}\n      <div className=\"px-4 py-4 bg-white border-b border-gray-100\">\n        <h2 className=\"text-sm font-bold text-gray-700 mb-3\">Синхронизация с Google Sheets</h2>\n        <p className=\"text-xs text-gray-400 mb-3\">\n          Вставьте URL из Google Apps Script для автоматической записи в таблицу\n        </p>\n        <div className=\"space-y-3\">\n          <div>\n            <label className=\"text-xs text-gray-500 block mb-1\">URL скрипта</label>\n            <input\n              type=\"url\"\n              value={scriptUrl}\n              onChange={(e) => setScriptUrl(e.target.value)}\n              placeholder=\"https://script.google.com/macros/s/...\"\n              className=\"w-full border border-gray-200 rounded-xl px-4 py-2.5 text-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-300\"\n            />\n          </div>\n          <div>\n            <label className=\"text-xs text-gray-500 block mb-1\">PIN</label>\n            <input\n              type=\"text\"\n              value={pin}\n              onChange={(e) => setPin(e.target.value)}\n              placeholder=\"1234\"\n              className=\"w-full border border-gray-200 rounded-xl px-4 py-2.5 text-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-300\"\n            />\n          </div>\n          <button\n            onClick={handleSave}\n            className={`w-full py-2.5 rounded-xl font-medium text-sm transition-all ${\n              saved ? 'bg-emerald-500 text-white' : 'bg-blue-500 text-white'\n            }`}\n          >\n            {saved ? 'Сохранено!' : 'Сохранить настройки'}\n          </button>\n        </div>\n      </div>\n\n      {/* Data management */}\n      <div className=\"px-4 py-4 bg-white border-b border-gray-100\">\n        <h2 className=\"text-sm font-bold text-gray-700 mb-3\">Данные</h2>\n        <p className=\"text-xs text-gray-400 mb-3\">\n          Размер данных: <span className=\"font-medium text-gray-600\">{dataSize}</span>\n        </p>\n        <div className=\"space-y-2\">\n          <button\n            onClick={handleExportAll}\n            className=\"w-full py-2.5 rounded-xl font-medium text-sm bg-gray-100 text-gray-700\"\n          >\n            Экспорт (JSON backup)\n          </button>\n          <button\n            onClick={handleImport}\n            className=\"w-full py-2.5 rounded-xl font-medium text-sm bg-gray-100 text-gray-700\"\n          >\n            Импорт из файла\n          </button>\n          <button\n            onClick={handleClearData}\n            className=\"w-full py-2.5 rounded-xl font-medium text-sm bg-red-50 text-red-600\"\n          >\n            Удалить все данные\n          </button>\n        </div>\n      </div>\n\n      {/* Info */}\n      <div className=\"px-4 py-4 text-center text-xs text-gray-400\">\n        <p>Журнал посещаемости v1.0</p>\n        <p className=\"mt-1\">Данные хранятся в браузере телефона</p>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}