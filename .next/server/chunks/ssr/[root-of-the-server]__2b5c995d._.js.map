{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","../../../../src/lib/sync.ts","../../../../src/app/settings/page.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","import { DayAttendance } from './types';\n\nconst SETTINGS_KEY = 'el-jurnal-settings';\n\ninterface SyncSettings {\n  scriptUrl: string;\n  pin: string;\n}\n\nexport function getSyncSettings(): SyncSettings | null {\n  if (typeof window === 'undefined') return null;\n  try {\n    const raw = localStorage.getItem(SETTINGS_KEY);\n    return raw ? JSON.parse(raw) : null;\n  } catch {\n    return null;\n  }\n}\n\nexport function saveSyncSettings(settings: SyncSettings) {\n  if (typeof window === 'undefined') return;\n  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n}\n\nexport async function syncToSheets(day: DayAttendance): Promise<{ success: boolean; message: string }> {\n  const settings = getSyncSettings();\n  if (!settings?.scriptUrl) {\n    return { success: false, message: 'Не настроена синхронизация' };\n  }\n\n  try {\n    const url = `${settings.scriptUrl}?action=saveAttendance&pin=${encodeURIComponent(settings.pin)}`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(day),\n      mode: 'no-cors',\n    });\n\n    // Google Apps Script с no-cors возвращает opaque response\n    // Используем redirect-based approach\n    return { success: true, message: 'Отправлено в Google Sheets' };\n  } catch (err) {\n    return { success: false, message: `Ошибка: ${err}` };\n  }\n}\n\nexport async function syncSaveAttendance(day: DayAttendance): Promise<{ success: boolean; message: string }> {\n  const settings = getSyncSettings();\n  if (!settings?.scriptUrl) {\n    return { success: false, message: 'Синхронизация не настроена' };\n  }\n\n  try {\n    // Google Apps Script web apps need a special approach for POST\n    // We use a form-based approach that works with CORS\n    const formData = new URLSearchParams();\n    formData.append('action', 'saveAttendance');\n    formData.append('pin', settings.pin);\n    formData.append('data', JSON.stringify(day));\n\n    const response = await fetch(settings.scriptUrl, {\n      method: 'POST',\n      body: formData,\n      redirect: 'follow',\n    });\n\n    if (response.ok) {\n      const result = await response.json();\n      return { success: true, message: result.message || 'Сохранено в Google Sheets' };\n    }\n\n    return { success: true, message: 'Данные отправлены' };\n  } catch {\n    // With Google Apps Script, even \"failed\" requests often succeed\n    return { success: true, message: 'Данные отправлены в Google Sheets' };\n  }\n}\n","'use client';\n\nimport { useState, useEffect } from 'react';\nimport { getSyncSettings, saveSyncSettings } from '@/lib/sync';\nimport Link from 'next/link';\n\nexport default function SettingsPage() {\n  const [scriptUrl, setScriptUrl] = useState('');\n  const [pin, setPin] = useState('');\n  const [saved, setSaved] = useState(false);\n  const [dataSize, setDataSize] = useState('');\n\n  useEffect(() => {\n    const settings = getSyncSettings();\n    if (settings) {\n      setScriptUrl(settings.scriptUrl);\n      setPin(settings.pin);\n    }\n\n    // Calculate localStorage usage\n    try {\n      const data = localStorage.getItem('el-jurnal-attendance');\n      if (data) {\n        const bytes = new Blob([data]).size;\n        if (bytes < 1024) setDataSize(`${bytes} B`);\n        else setDataSize(`${(bytes / 1024).toFixed(1)} KB`);\n      } else {\n        setDataSize('0 B');\n      }\n    } catch {\n      setDataSize('N/A');\n    }\n  }, []);\n\n  const handleSave = () => {\n    saveSyncSettings({ scriptUrl, pin });\n    setSaved(true);\n    setTimeout(() => setSaved(false), 2000);\n  };\n\n  const handleExportAll = () => {\n    try {\n      const data = localStorage.getItem('el-jurnal-attendance') || '{}';\n      const blob = new Blob([data], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `jurnal-backup-${new Date().toISOString().slice(0, 10)}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } catch (err) {\n      alert('Ошибка экспорта: ' + err);\n    }\n  };\n\n  const handleImport = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    input.onchange = (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (!file) return;\n      const reader = new FileReader();\n      reader.onload = (ev) => {\n        try {\n          const data = JSON.parse(ev.target?.result as string);\n          localStorage.setItem('el-jurnal-attendance', JSON.stringify(data));\n          alert('Данные импортированы!');\n          window.location.reload();\n        } catch {\n          alert('Ошибка: неверный формат файла');\n        }\n      };\n      reader.readAsText(file);\n    };\n    input.click();\n  };\n\n  const handleClearData = () => {\n    if (confirm('Удалить ВСЕ данные посещаемости? Это действие необратимо!')) {\n      localStorage.removeItem('el-jurnal-attendance');\n      alert('Данные удалены');\n      window.location.reload();\n    }\n  };\n\n  return (\n    <div className=\"max-w-lg mx-auto pb-8\">\n      <header className=\"bg-blue-500 text-white px-4 py-3 sticky top-0 z-50 shadow-md\">\n        <div className=\"flex items-center justify-between\">\n          <Link href=\"/\" className=\"text-sm bg-white/20 px-3 py-1.5 rounded-lg\">\n            &larr; Назад\n          </Link>\n          <h1 className=\"text-lg font-bold\">Настройки</h1>\n          <div className=\"w-16\" />\n        </div>\n      </header>\n\n      {/* Google Sheets sync */}\n      <div className=\"px-4 py-4 bg-white border-b border-gray-100\">\n        <h2 className=\"text-sm font-bold text-gray-700 mb-3\">Синхронизация с Google Sheets</h2>\n        <p className=\"text-xs text-gray-400 mb-3\">\n          Вставьте URL из Google Apps Script для автоматической записи в таблицу\n        </p>\n        <div className=\"space-y-3\">\n          <div>\n            <label className=\"text-xs text-gray-500 block mb-1\">URL скрипта</label>\n            <input\n              type=\"url\"\n              value={scriptUrl}\n              onChange={(e) => setScriptUrl(e.target.value)}\n              placeholder=\"https://script.google.com/macros/s/...\"\n              className=\"w-full border border-gray-200 rounded-xl px-4 py-2.5 text-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-300\"\n            />\n          </div>\n          <div>\n            <label className=\"text-xs text-gray-500 block mb-1\">PIN</label>\n            <input\n              type=\"text\"\n              value={pin}\n              onChange={(e) => setPin(e.target.value)}\n              placeholder=\"1234\"\n              className=\"w-full border border-gray-200 rounded-xl px-4 py-2.5 text-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-300\"\n            />\n          </div>\n          <button\n            onClick={handleSave}\n            className={`w-full py-2.5 rounded-xl font-medium text-sm transition-all ${\n              saved ? 'bg-emerald-500 text-white' : 'bg-blue-500 text-white'\n            }`}\n          >\n            {saved ? 'Сохранено!' : 'Сохранить настройки'}\n          </button>\n        </div>\n      </div>\n\n      {/* Data management */}\n      <div className=\"px-4 py-4 bg-white border-b border-gray-100\">\n        <h2 className=\"text-sm font-bold text-gray-700 mb-3\">Данные</h2>\n        <p className=\"text-xs text-gray-400 mb-3\">\n          Размер данных: <span className=\"font-medium text-gray-600\">{dataSize}</span>\n        </p>\n        <div className=\"space-y-2\">\n          <button\n            onClick={handleExportAll}\n            className=\"w-full py-2.5 rounded-xl font-medium text-sm bg-gray-100 text-gray-700\"\n          >\n            Экспорт (JSON backup)\n          </button>\n          <button\n            onClick={handleImport}\n            className=\"w-full py-2.5 rounded-xl font-medium text-sm bg-gray-100 text-gray-700\"\n          >\n            Импорт из файла\n          </button>\n          <button\n            onClick={handleClearData}\n            className=\"w-full py-2.5 rounded-xl font-medium text-sm bg-red-50 text-red-600\"\n          >\n            Удалить все данные\n          </button>\n        </div>\n      </div>\n\n      {/* Info */}\n      <div className=\"px-4 py-4 text-center text-xs text-gray-400\">\n        <p>Журнал посещаемости v1.0</p>\n        <p className=\"mt-1\">Данные хранятся в браузере телефона</p>\n      </div>\n    </div>\n  );\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React","AppRouterContext","ReactServerDOMTurbopackClient"],"mappings":"0NA0BQG,EAAOC,OAAO,CAAGC,EAAQ,CAAA,CAAA,IAAA,iCC1BjCF,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEC,eAAe,+BCFxCP,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEE,KAAK,8BCF9BR,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,QAAW,CAACG,gBAAgB,+BCFvCT,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRI,QAAQ,CAAC,YAAY,CAAEI,6BAA6B,yBCO/C,SAAS,IACqB,OAAO,IAO5C,CAEO,SAAS,EAAiB,CAAsB,EAGvD,CAyBO,eAAe,EAAmB,CAAkB,EACzD,IAAM,EAAW,IACjB,GAAI,CAAC,GAAU,UACb,CADwB,KACjB,CAAE,SAAS,EAAO,QAAS,4BAA6B,EAGjE,GAAI,CAGF,IAAM,EAAW,IAAI,gBACrB,EAAS,MAAM,CAAC,SAAU,kBAC1B,EAAS,MAAM,CAAC,MAAO,EAAS,GAAG,EACnC,EAAS,MAAM,CAAC,OAAQ,KAAK,SAAS,CAAC,IAEvC,IAAM,EAAW,MAAM,MAAM,EAAS,SAAS,CAAE,CAC/C,OAAQ,OACR,KAAM,EACN,SAAU,QACZ,GAEA,GAAI,EAAS,EAAE,CAAE,CACf,IAAM,EAAS,MAAM,EAAS,IAAI,GAClC,MAAO,CAAE,SAAS,EAAM,QAAS,EAAO,OAAO,EAAI,2BAA4B,CACjF,CAEA,MAAO,CAAE,QAAS,GAAM,QAAS,mBAAoB,CACvD,CAAE,KAAM,CAEN,MAAO,CAAE,SAAS,EAAM,QAAS,mCAAoC,CACvE,CACF,6HC3EA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,GAAM,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACrC,CAAC,EAAK,EAAO,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACzB,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC7B,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,UAEzC,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAM,EAAW,CAAA,EAAA,EAAA,eAAA,AAAe,IAC5B,IACF,EAAa,EAAS,EADV,OACmB,EAC/B,EAAO,EAAS,GAAG,GAIrB,GAAI,CACF,IAAM,EAAO,aAAa,OAAO,CAAC,wBAClC,GAAI,EAAM,CACR,IAAM,EAAQ,IAAI,KAAK,CAAC,EAAK,EAAE,IAAI,CAC/B,EAAQ,KAAM,EAAY,CAAA,EAAG,EAAM,EAAE,CAAC,EACrC,EAAY,CAAA,EAAG,CAAC,EAAQ,IAAA,CAAI,CAAE,OAAO,CAAC,GAAG,GAAG,CAAC,CACpD,MACE,CADK,CACO,MAEhB,CAAE,KAAM,CACN,EAAY,MACd,CACF,EAAG,EAAE,EAuDH,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kCACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,wEAChB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,IAAI,UAAU,sDAA6C,YAGtE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6BAAoB,cAClC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,cAKnB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,kCACrD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,2EAG1C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,4CAAmC,gBACpD,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,MACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAa,EAAE,MAAM,CAAC,KAAK,EAC5C,YAAY,yCACZ,UAAU,mIAGd,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,4CAAmC,QACpD,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,OACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAO,EAAE,MAAM,CAAC,KAAK,EACtC,YAAY,OACZ,UAAU,mIAGd,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QA5FS,CA4FA,IA3FjB,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,WAAE,EAAW,KAAI,GAClC,GAAS,GACT,WAAW,IAAM,GAAS,GAAQ,IACpC,EAyFU,UAAW,CAAC,4DAA4D,EACtE,EAAQ,4BAA8B,yBAAA,CACtC,UAED,EAAQ,aAAe,8BAM9B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,WACrD,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA6B,kBACzB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,qCAA6B,OAE9D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAxGc,CAwGL,IAvGjB,GAAI,CACF,IAAM,EAAO,aAAa,OAAO,CAAC,yBAA2B,KACvD,EAAO,IAAI,KAAK,CAAC,EAAK,CAAE,CAAE,KAAM,kBAAmB,GACnD,EAAM,IAAI,eAAe,CAAC,GAC1B,EAAI,SAAS,aAAa,CAAC,KACjC,EAAE,IAAI,CAAG,EACT,EAAE,QAAQ,CAAG,CAAC,cAAc,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,EAAG,IAAI,KAAK,CAAC,CAC1E,EAAE,KAAK,GACP,IAAI,eAAe,CAAC,EACtB,CAAE,MAAO,EAAK,CACZ,MAAM,oBAAsB,EAC9B,CACF,EA4FU,UAAU,kFACX,0BAGD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QA/FW,CA+FF,IA9FjB,IAAM,EAAQ,SAAS,aAAa,CAAC,SACrC,EAAM,IAAI,CAAG,OACb,EAAM,MAAM,CAAG,QACf,EAAM,QAAQ,CAAG,AAAC,IAChB,IAAM,EAAQ,EAAE,MAAM,CAAsB,KAAK,EAAE,CAAC,EAAE,CACtD,GAAI,CAAC,EAAM,OACX,IAAM,EAAS,IAAI,WACnB,EAAO,MAAM,CAAG,AAAC,IACf,GAAI,CACF,IAAM,EAAO,KAAK,KAAK,CAAC,EAAG,MAAM,EAAE,QACnC,aAAa,OAAO,CAAC,uBAAwB,KAAK,SAAS,CAAC,IAC5D,MAAM,yBACN,OAAO,QAAQ,CAAC,MAAM,EACxB,CAAE,KAAM,CACN,MAAM,gCACR,CACF,EACA,EAAO,UAAU,CAAC,EACpB,EACA,EAAM,KAAK,EACb,EA2EU,UAAU,kFACX,oBAGD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QA9Ec,CA8EL,IA7Eb,QAAQ,8DAA8D,CACxE,aAAa,UAAU,CAAC,wBACxB,MAAM,kBACN,OAAO,QAAQ,CAAC,MAAM,GAE1B,EAyEU,UAAU,+EACX,6BAOL,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,UAAE,6BACH,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,gBAAO,6CAI5B","ignoreList":[0,1,2,3,4]}