module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},97877,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(97877).vendored["react-ssr"].ReactServerDOMTurbopackClient},76808,a=>{"use strict";function b(a){return({})[a]||null}function c(a){}function d(a){}function e(){return null}function f(a){return[["№","ФИО студента",...a.subjects,"ИТОГО","Из них по уважит.","% пропусков","% неуважит. проп."],["","Кол. часов",...a.subjects.map(b=>String(a.subjectHours[b])),String(a.totalHours),"","",""],...a.rows.map((b,c)=>[String(c+1),b.studentName,...a.subjects.map(a=>String(b.bySubject[a]||"")),String(b.total),String(b.excused),b.totalPercent,b.unexcusedPercent])].map(a=>a.join(",")).join("\n")}a.s(["cacheConfig",()=>d,"exportReportCSV",()=>f,"getCachedConfig",()=>e,"getDayAttendance",()=>b,"saveDayAttendance",()=>c])},33435,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(76808),e=a.i(38246);let f=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];function g(){let a=new Date,[g,h]=(0,c.useState)(a.getFullYear()),[i,j]=(0,c.useState)(a.getMonth()+1),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(""),q=async()=>{n(!0),p("");try{let a=await fetch("/api/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({month:i,year:g})}),b=await a.json();a.ok&&b.report?(l(b.report),p(b.message||"Отчёт сгенерирован")):p(b.error||"Ошибка генерации")}catch{p("Ошибка сети")}n(!1)},r=k?.subjects||[];return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto pb-8",children:[(0,b.jsx)("header",{className:"bg-blue-500 text-white px-4 py-3 sticky top-0 z-50 shadow-md",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(e.default,{href:"/",className:"text-sm bg-white/20 px-3 py-1.5 rounded-lg",children:"← Журнал"}),(0,b.jsx)("h1",{className:"text-lg font-bold",children:"Отчёт"}),(0,b.jsx)("button",{onClick:()=>{if(!k)return;let a=new Blob(["\uFEFF"+(0,d.exportReportCSV)(k)],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`otchet-${k.group}-${String(i).padStart(2,"0")}.${g}.csv`,c.click(),URL.revokeObjectURL(b)},disabled:!k,className:"text-sm bg-white/20 px-3 py-1.5 rounded-lg disabled:opacity-40",children:"CSV"})]})}),(0,b.jsxs)("div",{className:"px-4 py-3 bg-white border-b border-gray-100",children:[(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:f.map((a,c)=>(0,b.jsx)("button",{onClick:()=>{j(c+1),l(null)},className:`px-3 py-1.5 rounded-lg text-sm whitespace-nowrap shrink-0 ${i===c+1?"bg-blue-500 text-white font-medium":"bg-gray-100 text-gray-400"}`,children:a.slice(0,3)},c))}),(0,b.jsx)("div",{className:"flex gap-2 mt-2",children:[2024,2025,2026].map(a=>(0,b.jsx)("button",{onClick:()=>{h(a),l(null)},className:`px-3 py-1 rounded-lg text-sm ${g===a?"bg-blue-100 text-blue-700 font-medium":"bg-gray-50 text-gray-400"}`,children:a},a))})]}),(0,b.jsxs)("div",{className:"px-4 py-4 bg-white border-b border-gray-100",children:[(0,b.jsx)("button",{onClick:q,disabled:m,className:`w-full py-3 rounded-xl font-bold text-base transition-all ${m?"bg-gray-300 text-gray-500":"bg-blue-500 text-white active:scale-[0.98]"}`,children:m?"Генерация...":`Сгенерировать отчёт за ${f[i-1].toLowerCase()}`}),o&&(0,b.jsx)("p",{className:`text-sm text-center mt-2 ${o.includes("Ошибка")?"text-red-500":"text-emerald-600"}`,children:o}),k&&!o.includes("Ошибка")&&(0,b.jsx)("p",{className:"text-xs text-center mt-1 text-gray-400",children:"Листы «Отчет» и «Подробно» обновлены в Google Таблице"})]}),k&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"px-4 py-3 bg-white border-b border-gray-100 text-center",children:[(0,b.jsxs)("h2",{className:"text-sm font-bold text-gray-700",children:["Анализ посещаемости группы ",k.group]}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mt-0.5",children:["за ",k.month," ",g," г. | Куратор: ",k.curator]}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:["Всего часов: ",k.totalHours]})]}),(0,b.jsx)("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-100",children:(0,b.jsx)("div",{className:"flex gap-1 overflow-x-auto text-xs",children:r.map(a=>(0,b.jsxs)("div",{className:"text-center shrink-0 min-w-[48px]",children:[(0,b.jsx)("div",{className:"text-gray-400 truncate",children:a.slice(0,4)}),(0,b.jsxs)("div",{className:"font-bold text-gray-600",children:[k.subjectHours[a],"ч"]})]},a))})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-xs",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,b.jsx)("th",{className:"px-2 py-2 text-left sticky left-0 bg-gray-50 z-10 min-w-[140px]",children:"ФИО"}),r.map(a=>(0,b.jsx)("th",{className:"px-1.5 py-2 text-center min-w-[36px]",title:a,children:a.slice(0,3)},a)),(0,b.jsx)("th",{className:"px-1.5 py-2 text-center font-bold",children:"Ит."}),(0,b.jsx)("th",{className:"px-1.5 py-2 text-center",children:"Ув."}),(0,b.jsx)("th",{className:"px-1.5 py-2 text-center",children:"%"}),(0,b.jsx)("th",{className:"px-1.5 py-2 text-center",children:"%Н"})]})}),(0,b.jsx)("tbody",{children:k.rows.map((a,c)=>a.studentName?(0,b.jsxs)("tr",{className:`border-b border-gray-100 ${a.total>0?"":"text-gray-300"}`,children:[(0,b.jsxs)("td",{className:"px-2 py-2 sticky left-0 bg-white z-10 font-medium truncate max-w-[140px]",children:[(0,b.jsxs)("span",{className:"text-gray-400 mr-1",children:[c+1,"."]}),a.studentName]}),r.map(c=>(0,b.jsx)("td",{className:`px-1.5 py-2 text-center ${a.bySubject[c]>0?"text-red-600 font-medium":"text-gray-300"}`,children:a.bySubject[c]||""},c)),(0,b.jsx)("td",{className:`px-1.5 py-2 text-center font-bold ${a.total>0?"text-red-600":"text-gray-300"}`,children:a.total||""}),(0,b.jsx)("td",{className:"px-1.5 py-2 text-center text-amber-600",children:a.excused||""}),(0,b.jsx)("td",{className:`px-1.5 py-2 text-center ${parseInt(a.totalPercent)>30?"text-red-600 font-bold":""}`,children:a.total>0?a.totalPercent:""}),(0,b.jsx)("td",{className:`px-1.5 py-2 text-center ${parseInt(a.unexcusedPercent)>20?"text-red-600 font-bold":""}`,children:a.total>0?a.unexcusedPercent:""})]},a.studentId):null)})]})})]}),!k&&(0,b.jsxs)("div",{className:"px-4 py-16 text-center text-gray-400",children:[(0,b.jsx)("p",{className:"text-lg mb-2",children:"Выберите месяц и нажмите «Сгенерировать»"}),(0,b.jsx)("p",{className:"text-sm",children:"Отчёт будет создан из данных Google Таблицы"})]})]})}a.s(["default",()=>g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__22c461d1._.js.map