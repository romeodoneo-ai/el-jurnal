# Журнал посещаемости СИС-12

Приложение читает и записывает данные напрямую в Google Таблицу.
Староста заполняет посещаемость с телефона, отчёт генерируется автоматически.

---

## 1. Подключение Google Sheets (обязательно)

### Шаг 1: Создайте Google Cloud проект

1. Откройте https://console.cloud.google.com
2. Войдите в Google аккаунт (тот же, где таблица)
3. Нажмите **"Select a project"** вверху → **"NEW PROJECT"**
4. Название: `jurnal` → **"CREATE"**

### Шаг 2: Включите Google Sheets API

1. В левом меню: **APIs & Services** → **Library**
2. В поиске введите: `Google Sheets API`
3. Нажмите на него → **"ENABLE"**

### Шаг 3: Создайте сервисный аккаунт

1. В левом меню: **APIs & Services** → **Credentials**
2. Нажмите **"+ CREATE CREDENTIALS"** → **"Service account"**
3. Имя: `jurnal-bot` → **"CREATE AND CONTINUE"**
4. Роль: пропустите (нажмите **"CONTINUE"**)
5. Нажмите **"DONE"**
6. В таблице нажмите на созданный аккаунт (`jurnal-bot@...`)
7. Вкладка **"KEYS"** → **"ADD KEY"** → **"Create new key"**
8. Тип: **JSON** → **"CREATE"**
9. Файл скачается — откройте его, там два важных поля:
   - `client_email` — это EMAIL сервисного аккаунта
   - `private_key` — это ПРИВАТНЫЙ КЛЮЧ

### Шаг 4: Расшарьте таблицу

1. Откройте вашу Google Таблицу
2. Нажмите **"Настройки доступа"** (кнопка справа вверху)
3. В поле "Добавить" вставьте `client_email` из JSON файла
4. Выберите роль: **Редактор**
5. Нажмите **"Отправить"**

### Шаг 5: Добавьте переменные в Vercel

1. Откройте ваш проект на https://vercel.com
2. **Settings** → **Environment Variables**
3. Добавьте 3 переменные:

| Key | Value | Откуда |
|---|---|---|
| `GOOGLE_SPREADSHEET_ID` | `1RxPw49gfkPL_fatIQfz0Iegd0qZiumrejSaRLutGZnY` | Из URL таблицы |
| `GOOGLE_SERVICE_ACCOUNT_EMAIL` | `jurnal-bot@ваш-проект.iam.gserviceaccount.com` | Поле `client_email` из JSON |
| `GOOGLE_PRIVATE_KEY` | `-----BEGIN PRIVATE KEY-----\nMIIEvQ...` | Поле `private_key` из JSON |

4. Нажмите **"Save"** для каждой переменной
5. Перейдите в **Deployments** → нажмите **"..."** у последнего деплоя → **"Redeploy"**

### Готово!

Через ~1 минуту приложение подключится к вашей таблице.
Проверьте: откройте приложение → Настройки (шестерёнка) → должно быть "Подключено".

---

## 2. Как пользоваться

### Для старосты (ежедневно):
1. Открыть приложение на телефоне
2. Выбрать дату (сегодня по умолчанию)
3. Пары и предметы подтягиваются из таблицы автоматически
4. Нажать на кнопку справа от отсутствующего: `+` → `Н` → `У` → `+`
5. Нажать "Сохранить" — данные уходят в Google Таблицу

### Для куратора (раз в месяц):
1. Открыть приложение → "Отчёт"
2. Выбрать месяц
3. Нажать "Сгенерировать" — листы "Отчет" и "Подробно" обновятся в таблице

---

## 3. Разработка (локально)

```bash
# Установить зависимости
npm install

# Скопировать настройки
cp .env.local.example .env.local
# Заполнить .env.local реальными значениями

# Запустить
npm run dev
```

Откройте http://localhost:3000

---

## Структура проекта

```
src/
  app/
    page.tsx              — Главная: ввод посещаемости
    report/page.tsx       — Генерация отчёта
    settings/page.tsx     — Статус подключения + кеш
    api/
      config/route.ts     — API: чтение студентов/предметов из Sheets
      attendance/route.ts — API: чтение/запись посещаемости
      report/route.ts     — API: генерация отчёта в Sheets
  lib/
    google-sheets.ts      — Клиент Google Sheets API
    sheets-config.ts      — Структура листов (номера строк/колонок)
    sheets-report.ts      — Логика генерации отчёта
    config.ts             — Фоллбэк-данные для офлайна
    storage.ts            — Локальный кеш (localStorage)
    types.ts              — TypeScript типы
```

## Как изменить список студентов или предметов

Просто измените в Google Таблице — приложение читает оттуда автоматически.
